// TODO move logic in route, to a function here